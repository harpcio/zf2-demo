box: wercker/php
build:
  steps:
    - script:
        name: switch to php 5.5
        code: |-
            phpenv global 5.5
            echo 'date.timezone = "Europe/Warsaw"' >> $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini
    - script:
        name: install dependencies
        code: |-
            composer install --no-interaction --dev
    - script:
        name: serve application
        code: |-
            php -S localhost:8000 >> /dev/null &
    - script:
        name: PHPUnit integration tests
        code: |-
            mkdir -p build/logs
            phpunit --configuration test/phpunit.xml
            phpunit --configuration test/phpunit.xml --testdox --coverage-clover ../build/logs/clover.xml